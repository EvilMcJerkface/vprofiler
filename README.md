# VProfiler

VProfiler is a profiling tool that can efficiently and rigorously decompose the variance of the overall execution time of an application by automatically instrumenting its source code, and identifying the major functions that contribute the most to the overall variance. This tool is still at an early version, and it supports only MySQL and Postgres.

This tool contains four parts:

1. ExecutionTimeTracer: the tracer collects execution time data for a certain function and all the function called in that function. It also collects latency data. Appropriate functions should be called in order to mark the start and end of a query and transaction. Data files will be generated after each run with all the execution time data for further analysis. The current version of this tool supports only MySQL and Postgres. 

Usage: Add the files to the code base of the application. Call function `start_new_query()`, `query_end()` and `end_transaction()` at the appropriate location to mark the start, end of a query and end of a transaction. The data files will be put in folder `latency`. Make sure that this folder exists.

2. SourceAnnotator: the annotator instruments the source code of the software application. It inserts appropriate function calls to call the functions defined in ExectuionTimeTracer to mark the start and end of a function call.

Usage: Compile the source code file and then run it in this way:
```
SourceAnnotator [source_code_file] [function_name]
```

After running this tool, update the value of `NUMBER_OF_FUNCTIONS` in file `trace_tool.cc` of the ExecutionTimeTracer.

3. VarianceBreaker: Given the execution time data generated by ExecutionTimeTracer, the breaker breaks down the variance of a function into variance and covarainces of its child functions and add corresponding entries to the variance tree file contained in the FactorSelector.

Usage: Change the path in the script to point to the data file and variance tree file, respectively, and then run it. The script will automatically add new entries to the varance tree file.

4. FactorSelector: Given the variance tree generated by the VarianceBreaker, the selector performs a selections on the variance tree to select the top k most interesting functions. Note that this tool requires a pre-generated static call graph for the software application. Such call graph can be generated using tools like [CodeViz](http://www.csn.ul.ie/~mel/projects/codeviz/). A tool is supplied to parse the call graph and compute the height of each function in the call graph, starting from the entry function.

Usage: Change the file names for the file containing function height and the path of the variance tree file in file `SourceOfVariance.java` and run it.
